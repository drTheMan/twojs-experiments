// Generated by CoffeeScript 1.6.3
(function() {
  var BrokenSquare, BrokenSquareRow, BrokenSquares,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  this.BrokenSquaresOps = (function(_super) {
    __extends(BrokenSquaresOps, _super);

    function BrokenSquaresOps(_opts) {
      this.options = _opts;
      this.init();
    }

    BrokenSquaresOps.prototype.init = function() {
      this.destroy();
      this.target = this.options.target || this.options.brokenSqaures || this.options.broken_squares || new BrokenSquares({
        two: this.options.two
      });
      this.two = this.target.two;
      return this.target.on('destroy', (function() {
        return this.destroy();
      }), this);
    };

    BrokenSquaresOps.prototype.destroy = function() {
      return this.target = this.two = void 0;
    };

    BrokenSquaresOps.prototype.randomBreak = function(likeliness, broken_squares) {
      return _.each(broken_squares || this.target.broken_squares, function(broken_square) {
        return _.each(broken_square.triangles, function(triangle) {
          if (Math.random() > (likeliness || 0.4)) {
            return triangle.opacity = 0.0;
          } else {
            return triangle.opacity = 1.0;
          }
        });
      });
    };

    BrokenSquaresOps.prototype.scrollTween = function() {
      var height, squares, tween;
      height = this.target.gridH() * this.target.rowH();
      squares = this.target._createBrokenSquares(0, height - this.target.group.translation.y);
      this.randomBreak(0.4, squares);
      this.target.addBrokenSquares(squares);
      console.log([this.two.height, height]);
      return tween = new TWEEN.Tween(this.target.group.translation).to({
        y: this.target.group.translation.y - height
      }, 2500).easing(TWEEN.Easing.Linear.None);
    };

    return BrokenSquaresOps;

  })(Backbone.Model);

  BrokenSquares = (function(_super) {
    __extends(BrokenSquares, _super);

    function BrokenSquares(_opts) {
      this.options = _opts;
      this.two = _opts.two;
      this.init();
    }

    BrokenSquares.prototype.init = function() {
      this.destroy();
      this.group = this.two.makeGroup();
      return this.addBrokenSquares(this._createBrokenSquares());
    };

    BrokenSquares.prototype.destroy = function() {
      this.trigger('destroy', this);
      if (this.broken_squares) {
        _.each(this.broken_squares, function(broken_square) {
          return broken_square.destroy();
        });
        this.broken_squares = void 0;
      }
      if (this.group) {
        this.two.remove(this.group);
        return this.group = void 0;
      }
    };

    BrokenSquares.prototype.size = function() {
      return this.options.size || 50;
    };

    BrokenSquares.prototype.colSpacing = function() {
      return this.options.colSpacing || 30;
    };

    BrokenSquares.prototype.rowSpacing = function() {
      return this.options.rowSpacing || 30;
    };

    BrokenSquares.prototype.colW = function() {
      return this.size() + this.colSpacing();
    };

    BrokenSquares.prototype.rowH = function() {
      return this.size() + this.rowSpacing();
    };

    BrokenSquares.prototype.gridW = function() {
      return this.two.width / this.colW() + 1;
    };

    BrokenSquares.prototype.gridH = function() {
      return this.two.height / this.rowH() + 1;
    };

    BrokenSquares.prototype.addBrokenSquares = function(broken_squares) {
      var _this = this;
      this.broken_squares || (this.broken_squares = []);
      this.broken_squares = _.union(this.broken_squares, broken_squares);
      return _.each(broken_squares, function(broken_square) {
        return broken_square.group.addTo(_this.group);
      });
    };

    BrokenSquares.prototype._createBrokenSquares = function(startX, startY) {
      var result,
        _this = this;
      result = _.map(_.range(this.gridH()), function(y, idx, list) {
        return _.map(_.range(_this.gridW()), function(x, idx, list) {
          var bSquare;
          bSquare = new BrokenSquare({
            two: _this.two,
            size: _this.size()
          });
          bSquare.group.translation.set((startX || 0) + x * _this.colW(), (startY || 0) + y * _this.rowH());
          return bSquare;
        });
      });
      return _.flatten(result);
    };

    return BrokenSquares;

  })(Backbone.Model);

  BrokenSquare = (function(_super) {
    __extends(BrokenSquare, _super);

    function BrokenSquare(_opts) {
      this.options = _opts;
      this.two = _opts.two;
      this.init();
    }

    BrokenSquare.prototype.init = function() {
      var _this = this;
      this.destroy();
      this.group = this.two.makeGroup();
      this.triangles = this._createTriangles();
      _.each(this.triangles, function(triangle) {
        return triangle.addTo(_this.group);
      });
      this.group.fill = '#FFFFFF';
      return this.group.noStroke();
    };

    BrokenSquare.prototype.destroy = function() {
      var _this = this;
      this.trigger('destroy');
      if (this.triangles) {
        _.each(this.triangles, function(triangle) {
          return _this.two.remove(triangle);
        });
        this.triangles = void 0;
      }
      if (this.group) {
        this.two.remove(this.group);
        return this.group = void 0;
      }
    };

    BrokenSquare.prototype.width = function() {
      return this.options.width || this.options.size || 50;
    };

    BrokenSquare.prototype.height = function() {
      return this.options.height || this.options.size || 50;
    };

    BrokenSquare.prototype.coords = function() {
      return [new Two.Anchor(0, 0), new Two.Anchor(this.width() / 2, 0), new Two.Anchor(this.width(), 0), new Two.Anchor(0, this.height() / 2), new Two.Anchor(this.width() / 2, this.height() / 2), new Two.Anchor(this.width(), this.height() / 2), new Two.Anchor(0, this.height()), new Two.Anchor(this.width() / 2, this.height()), new Two.Anchor(this.width(), this.height())];
    };

    BrokenSquare.prototype._createTriangles = function() {
      var coords;
      coords = this.coords();
      return [new Two.Polygon([coords[0], coords[4], coords[3]], false, false), new Two.Polygon([coords[0], coords[1], coords[4]], false, false), new Two.Polygon([coords[1], coords[2], coords[4]], false, false), new Two.Polygon([coords[2], coords[4], coords[5]], false, false), new Two.Polygon([coords[3], coords[4], coords[6]], false, false), new Two.Polygon([coords[4], coords[6], coords[7]], false, false), new Two.Polygon([coords[4], coords[7], coords[8]], false, false), new Two.Polygon([coords[4], coords[5], coords[8]], false, false)];
    };

    return BrokenSquare;

  })(Backbone.Model);

  BrokenSquareRow = (function(_super) {
    __extends(BrokenSquareRow, _super);

    function BrokenSquareRow(_opts) {
      this.options = _opts;
      this.two = _opts.two;
      this.init();
    }

    BrokenSquareRow.prototype.init = function() {
      var _this = this;
      this.destroy();
      this.group = this.two.makeGroup();
      this.broken_squares = this._create();
      _.each(this.broken_squares, function(broken_square) {
        return broken_square.group.addTo(_this.group);
      });
      this.group.fill = '#FFFFFF';
      return this.group.noStroke();
    };

    BrokenSquareRow.prototype.destroy = function() {
      var _this = this;
      this.trigger('destroy');
      if (this.broken_squares) {
        _.each(this.broken_squares, function(broken_square) {
          return broken_square.destroy();
        });
        this.broken_squares = void 0;
      }
      if (this.group) {
        this.two.remove(this.group);
        return this.group = void 0;
      }
    };

    BrokenSquareRow.prototype.size = function() {
      return this.options.size || 50;
    };

    BrokenSquareRow.prototype.colSpacing = function() {
      return this.options.colSpacing || 30;
    };

    BrokenSquareRow.prototype.rowSpacing = function() {
      return this.options.rowSpacing || 30;
    };

    BrokenSquareRow.prototype.colW = function() {
      return this.size() + this.colSpacing();
    };

    BrokenSquareRow.prototype.rowH = function() {
      return this.size() + this.rowSpacing();
    };

    BrokenSquareRow.prototype.gridW = function() {
      return this.two.width / this.colW() + 1;
    };

    BrokenSquareRow.prototype.gridH = function() {
      return this.two.height / this.rowH() + 1;
    };

    BrokenSquareRow.prototype._create = function() {
      var _this = this;
      return _.map(_.range(this.gridW()), function(x) {
        var bSquare;
        bSquare = new BrokenSquare({
          two: _this.two,
          size: _this.size()
        });
        bSquare.group.translation.set(x * _this.colW(), 0);
        return bSquare;
      });
    };

    return BrokenSquareRow;

  })(Backbone.Model);

}).call(this);
